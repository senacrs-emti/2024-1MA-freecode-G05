<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campo Minado</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        .board {
            display: grid;
            grid-template-columns: repeat(18, 30px);
            justify-content: center;
            margin-top: 20px;
        }
        .cell {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #999;
            font-size: 16px;
            cursor: pointer;
            user-select: none;
        }
        .cell.revealed {
            cursor: default;
        }
        .cell.mine {
            background-color: red;
        }
        .cell.flag {
            background-color: yellow;
        }
        .number-1 { color: blue; }
        .number-2 { color: green; }
        .number-3 { color: red; }
        .number-4 { color: navy; }
        .number-5 { color: brown; }
        .number-6 { color: teal; }
        .number-7 { color: black; }
        .number-8 { color: gray; }
        .board .cell:nth-child(odd) { background-color: #a0d080; }
        .board .cell:nth-child(even) { background-color: #70a060; }
    </style>
</head>
<body>
    <h1>Campo Minado</h1>
    <p>Minas restantes: <span id="minesLeft"></span> | Tempo: <span id="timer">0</span>s</p>
    <button onclick="resetGame()">Reiniciar</button>
    <div class="board" id="board"></div>
    <script>
        const rows = 18;
        const cols = 18;
        let minesCount = 40;
        let board = [];
        let firstClick = true;
        let revealedCount = 0;
        let flagsLeft = minesCount;
        let timer = 0;
        let timerInterval;

        function startTimer() {
            clearInterval(timerInterval);
            timer = 0;
            document.getElementById("timer").textContent = timer;
            timerInterval = setInterval(() => {
                timer++;
                document.getElementById("timer").textContent = timer;
            }, 1000);
        }

        function createBoard(excludeRow, excludeCol) {
            board = Array(rows).fill().map(() => Array(cols).fill().map(() => ({ mine: false, revealed: false, count: 0, flag: false })));
            let minesPlaced = 0;
            while (minesPlaced < minesCount) {
                let r = Math.floor(Math.random() * rows);
                let c = Math.floor(Math.random() * cols);
                if (!board[r][c].mine && Math.abs(r - excludeRow) > 2 && Math.abs(c - excludeCol) > 2) {
                    board[r][c].mine = true;
                    minesPlaced++;
                }
            }
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    if (!board[r][c].mine) {
                        let count = 0;
                        for (let dr = -1; dr <= 1; dr++) {
                            for (let dc = -1; dc <= 1; dc++) {
                                let nr = r + dr, nc = c + dc;
                                if (nr >= 0 && nr < rows && nc >= 0 && nc < cols && board[nr][nc].mine) {
                                    count++;
                                }
                            }
                        }
                        board[r][c].count = count;
                    }
                }
            }
        }

        function renderBoard() {
            document.getElementById("minesLeft").textContent = flagsLeft;
            const boardElement = document.getElementById("board");
            boardElement.innerHTML = "";
            board.forEach((row, r) => {
                row.forEach((cell, c) => {
                    const cellElement = document.createElement("div");
                    cellElement.className = "cell";
                    if (cell.revealed) {
                        cellElement.classList.add("revealed");
                        cellElement.style.backgroundColor = "#bbb";
                        if (cell.mine) {
                            cellElement.classList.add("mine");
                            cellElement.textContent = "ðŸ’£";
                        } else if (cell.count > 0) {
                            cellElement.classList.add(`number-${cell.count}`);
                            cellElement.textContent = cell.count;
                        }
                    } else if (cell.flag) {
                        cellElement.classList.add("flag");
                        cellElement.textContent = "ðŸš©";
                    }
                    cellElement.addEventListener("click", () => revealCell(r, c));
                    cellElement.addEventListener("contextmenu", (e) => {
                        e.preventDefault();
                        toggleFlag(r, c);
                    });
                    boardElement.appendChild(cellElement);
                });
            });
        }

        function revealCell(r, c) {
            if (board[r][c].revealed || board[r][c].flag) return;
            if (firstClick) {
                firstClick = false;
                createBoard(r, c);
                startTimer();
            }
            board[r][c].revealed = true;
            revealedCount++;
            if (board[r][c].mine) {
                alert("Game Over!");
                clearInterval(timerInterval);
                board.forEach(row => row.forEach(cell => cell.revealed = true));
            } else if (board[r][c].count === 0) {
                for (let dr = -1; dr <= 1; dr++) {
                    for (let dc = -1; dc <= 1; dc++) {
                        let nr = r + dr, nc = c + dc;
                        if (nr >= 0 && nr < rows && nc >= 0 && nc < cols) {
                            revealCell(nr, nc);
                        }
                    }
                }
            }
            checkWin();
            renderBoard();
        }

        function toggleFlag(r, c) {
            if (!board[r][c].revealed && flagsLeft > 0 || board[r][c].flag) {
                board[r][c].flag = !board[r][c].flag;
                flagsLeft += board[r][c].flag ? -1 : 1;
                renderBoard();
            }
        }

        function checkWin() {
            if (revealedCount === rows * cols - minesCount) {
                alert("VocÃª venceu!");
                clearInterval(timerInterval);
            }
        }

        function resetGame() {
            firstClick = true;
            revealedCount = 0;
            flagsLeft = minesCount;
            clearInterval(timerInterval);
            createBoard();
            renderBoard();
        }

        resetGame();
    </script>
</body>
</html>
